// Generated by CoffeeScript 1.3.1
((function(){var a,b,c,d,e=[].slice,f={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype
,a.prototype=new d,a.__super__=b.prototype,a};c=function(){var a,b,d,g,h,i,j;d=arguments[0],a=2<=arguments.length?e.call(arguments,1):[];if(d==null)return{};for(i=0,j=a.length;i<j;i++){g=a[i];for(b in 
g){if(!f.call(g,b))continue;h=g[b],d[b]==null||typeof h!="object"?d[b]=h:d[b]=c(d[b],h)}}return d},$.ender({fwData:function(a,b){var c;return this.data("_formwatcher")==null&&this.data("_formwatcher",{
}),a==null?this:(c=this.data("_formwatcher"),b!=null?(c[a]=b,this.data("_formwatcher",c),this):c[a])}},!0),d="input, textarea, select, button",a={version:"2.0.0-dev",debugging:!1,debug:function(){if(this
.debugging&&(typeof console!=="undefined"&&console!==null?console.debug:void 0)!=null)return console.debug.apply(console,arguments)},getErrorsElement:function(a,b){var c,d;d=a.input,d.attr("name")&&(c=
$("#"+d.attr("name")+"-errors")),(c!=null?c.length:void 0)||!d.attr("id")||(c=$("#"+d.attr("id")+"-errors"));if(!c||!c.length)c=$.create("<span />"),d.attr("name")&&c.attr("id",d.attr("name")+"-errors"
),c.insertAfter(d);return c.hide().addClass("errors").addClass("fw-errors"),c},getLabel:function(a,b){var c,d;c=a.input,d=void 0,c.attr("id")&&(d=$("label[for="+c.attr("id")+"]"),d.length||(d=undefined
));if(!d&&b){d=c.previous(),window.testinput=c;if(!d.length||d.get(0).nodeName!=="LABEL"||d.attr("for")!=null)d=void 0}return d},changed:function(b,c){var d;d=b.input;if(!d.fwData("forceValidationOnChange"
)&&d.attr("type")==="checkbox"&&d.fwData("previouslyChecked")===!!d[0].checked||d.fwData("previousValue")===d.val())return;d.fwData("forceValidationOnChange",!1),this.setPreviousValueToCurrentValue(b),
d.attr("type")==="checkbox"&&d.fwData("initialyChecked")!==!!d[0].checked||d.attr("type")!=="checkbox"&&d.fwData("initialValue")!==d.val()?a.setChanged(b,c):a.unsetChanged(b,c);if(c.options.validate)return c
.validateElements(b)},setChanged:function(b,c){var d,e,g;g=b.input;if(g.fwData("changed"))return;for(e in b){if(!f.call(b,e))continue;d=b[e],d.addClass("changed")}g.fwData("changed",!0),c.options.submitUnchanged||
a.restoreName(b);if(c.options.submitOnChange&&c.options.ajax)return c.submitForm()},unsetChanged:function(b,c){var d,e,g;g=b.input;if(!g.fwData("changed"))return;for(e in b){if(!f.call(b,e))continue;d=
b[e],d.removeClass("changed")}g.fwData("changed",!1);if(!c.options.submitUnchanged)return a.removeName(b)},storeInitialValue:function(a){var b;return b=a.input,b.attr("type")==="checkbox"?b.fwData("initialyChecked"
,!!b[0].checked):b.fwData("initialValue",b.val()),this.setPreviousValueToInitialValue(a)},restoreInitialValue:function(a){var b;return b=a.input,b.attr("type")==="checkbox"?b.attr("checked",b.fwData("initialyChecked"
)):b.val(b.fwData("initialValue")),this.setPreviousValueToInitialValue(a)},setPreviousValueToInitialValue:function(a){var b;return b=a.input,b.attr("type")==="checkbox"?b.fwData("previouslyChecked",b.fwData
("initialyChecked")):b.fwData("previousValue",b.fwData("initialValue"))},setPreviousValueToCurrentValue:function(a){var b;return b=a.input,b.attr("type")==="checkbox"?b.fwData("previouslyChecked",!!b[0
].checked):b.fwData("previousValue",b.val())},removeName:function(a){var b;b=a.input;if(b.attr("type")==="checkbox")return;return b.fwData("name")||b.fwData("name",b.attr("name")||""),b.attr("name","")
},restoreName:function(a){var b;b=a.input;if(b.attr("type")==="checkbox")return;return b.attr("name",b.fwData("name"))},Decorators:[],decorate:function(b,c){var d,e,f,g,h;e=null,h=b.decorators;for(f=0,
g=h.length;f<g;f++){d=h[f];if(d.accepts(c)){e=d;break}}return e?(a.debug('Decorator "'+e.name+'" found for input field "'+c.attr("name")+'".'),e.decorate(c)):{input:c}},Validators:[],currentWatcherId:0
,watchers:[],add:function(a){return this.watchers[a.id]=a},get:function(a){return this.watchers[a]},getAll:function(){return this.watchers},scanDocument:function(){var d,e,f;e=function(d){var e,f,g;d=$
(d);if(d.fwData("watcher"))return;return f=d.attr("id"),g=f!=null&&a.options[f]!=null?a.options[f]:{},e=d.data("fw"),e&&(g=c(g,e)),new b(d,g)},$('form[data-fw], form[data-fw=""]').each(function(a){return e
(a)}),f=[];for(d in a.options)f.push(e($("#"+d)));return f},watch:function(a,c){return $.domReady(function(){return new b(a,c)})}},a._ElementWatcher=function(){function a(a){var b;this.watcher=a,this.options=
c({},this.defaultOptions,(b=a.options[this.name])!=null?b:{})}return a.name="_ElementWatcher",a.prototype.name="No name",a.prototype.description="No description",a.prototype.nodeNames=null,a.prototype.
classNames=[],a.prototype.defaultOptions={},a.prototype.options=null,a.prototype.accepts=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(this.watcher.options[this.name]!=null&&this.watcher.options[this.name]===!1
)return!1;d=!1,e=a.get(0).nodeName,k=this.nodeNames;for(g=0,i=k.length;g<i;g++){f=k[g];if(e===f){d=!0;break}}if(!d)return!1;c=!0,l=this.classNames;for(h=0,j=l.length;h<j;h++){b=l[h];if(!a.hasClass(b)){
c=!1;break}}return c},a}(),a.Decorator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.name="Decorator",b.prototype.decorate=function(a,b){return{input:b}}
,b}(a._ElementWatcher),a.Validator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.name="Validator",b.prototype.nodeNames=["INPUT","TEXTAREA","SELECT"],b.prototype
.validate=function(a,b){return!0},b.prototype.sanitize=function(a){return a},b}(a._ElementWatcher),a.defaultOptions={ajax:!1,validate:!0,submitOnChange:!1,submitUnchanged:!0,submitFormIfAllUnchanged:!1
,resetFormAfterSubmit:!1,automatchLabel:!0,responseCheck:function(a){return!a},onSubmit:function(){},onSuccess:function(a){},onError:function(a){return alert(a)}},a.options={},b=function(){function b(b
,e){var f,g,h,i,j,k,l,m,n,o,p=this;this.form=typeof b=="string"?$("#"+b):$(b);if(this.form.length<1)throw"Form element not found.";if(this.form.length>1)throw"The jQuery contained more than 1 element."
;if(this.form.get(0).nodeName!=="FORM")throw"The element was not a form.";this.allElements=[],this.id=a.currentWatcherId++,a.add(this),this.observers={},this.form.fwData("watcher",this),this.form.fwData
("originalAction",this.form.attr("action")||"").attr("action","javascript:undefined;"),this.options=c({},a.defaultOptions,e||{}),this.decorators=[],this.validators=[],n=a.Decorators;for(j=0,l=n.length;
j<l;j++)f=n[j],this.decorators.push(new f(this));o=a.Validators;for(k=0,m=o.length;k<m;k++)g=o[k],this.validators.push(new g(this));this.observe("submit",this.options.onSubmit),this.observe("success",this
.options.onSuccess),this.observe("error",this.options.onError),$(d,this.form).each(function(b){var c,d,e,f,g,h,i,j,k,l,m,n;b=$(b);if(!b.fwData("initialized")){if(b.attr("type")==="hidden")return b.fwData
("forceSubmission",!0);d=a.decorate(p,b),d.input.get()!==b.get()&&(d.input.attr("class",b.attr("class")),b=d.input),d.label||(g=a.getLabel(d,p.options.automatchLabel),g&&(d.label=g)),d.errors||(e=a.getErrorsElement
(d,!0),d.errors=e),p.allElements.push(d),b.fwData("validators",[]),m=p.validators;for(k=0,l=m.length;k<l;k++)j=m[k],j.accepts(b,p)&&(a.debug('Validator "'+j.name+'" found for input field "'+b.attr("name"
)+'".'),b.fwData("validators").push(j));a.storeInitialValue(d);if(b.val()===null||!b.val())for(f in d)c=d[f],c.addClass("empty");p.options.submitUnchanged||a.removeName(d),h=function(){return a.changed
(d,p)},i=function(){return p.validateElements(d,!0)},n=[];for(f in d)c=d[f],c.on("focus",function(){return c.addClass("focus")}),c.on("blur",function(){return c.removeClass("focus")}),c.on("change",h),
c.on("blur",h),n.push(c.on("keyup",i));return n}}),i=$("input[type=submit], button[type=''], button[type='submit'], button:not([type])",this.form),h=$.create('<input type="hidden" name="" value="" />')
,this.form.append(h),i.each(function(a){return a=$(a),a.click(function(b){return h.attr("name",a.attr("name")||"").attr("value",a.attr("value")||""),p.submitForm(),b.stopPropagation()})})}return b.name="Watcher"
,b.prototype.callObservers=function(){var a,b,c,d,f,g,h;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],g=this.observers[b],h=[];for(d=0,f=g.length;d<f;d++)c=g[d],h.push(c.apply(this,a));return h
},b.prototype.observe=function(a,b){return this.observers[a]===undefined&&(this.observers[a]=[]),this.observers[a].push(b),this},b.prototype.stopObserving=function(a,b){var c;return this.observers[a]=function(
){var d,e,f,g;f=this.observers[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],c!==b&&g.push(c);return g}.call(this),this},b.prototype.enableForm=function(){return $(d,this.form).attr("disabled",!1)},b.prototype
.disableForm=function(){return $(d,this.form).attr("disabled",!0)},b.prototype.submitForm=function(a){var b=this;if(!this.options.validate||this.validateForm())return this.callObservers("submit"),this.
options.ajax?(this.disableForm(),this.submitAjax()):(this.form.attr("action",this.form.fwData("originalAction")),setTimeout(function(){return b.form.submit(),b.disableForm()},1),!1)},b.prototype.validateForm=
function(){var a,b,c,d,e;b=!0,e=this.allElements;for(c=0,d=e.length;c<d;c++)a=e[c],this.validateElements(a)||(b=!1);return b},b.prototype.validateElements=function(b,c){var d,e,g,h,i,j,k,l,m,n,o,p,q;g=
b.input,i=!0;if(g.fwData("validators").length){if(!c||!g.fwData("lastValidatedValue")||g.fwData("lastValidatedValue")!==g.val()){g.fwData("lastValidatedValue",g.val()),a.debug("Validating input "+g.attr
("name")),g.fwData("validationErrors",[]),p=g.fwData("validators");for(l=0,n=p.length;l<n;l++){k=p[l];if(g.val()===""&&k.name!=="Required"){a.debug("Validating "+k.name+". Field was empty so continuing."
);continue}a.debug("Validating "+k.name),j=k.validate(k.sanitize(g.val()),g);if(j!==!0){i=!1,g.fwData("validationErrors").push(j);break}}if(i){b.errors.html("").hide();for(e in b){if(!f.call(b,e))continue;
d=b[e],d.addClass("validated"),d.removeClass("error")}c&&b.input.fwData("forceValidationOnChange",!0)}else{for(e in b){if(!f.call(b,e))continue;d=b[e],d.removeClass("validated")}if(!c){b.errors.html(g.
fwData("validationErrors").join("<br />")).show();for(e in b){if(!f.call(b,e))continue;d=b[e],d.addClass("error")}}}}if(!c&&i){h=g.fwData("lastValidatedValue"),q=g.fwData("validators");for(m=0,o=q.length
;m<o;m++)k=q[m],h=k.sanitize(h);g.val(h)}}else for(e in b){if(!f.call(b,e))continue;d=b[e],d.addClass("validated")}return i},b.prototype.submitAjax=function(){var b,c,e,f=this;return a.debug("Submitting form via AJAX."
),c={},b=0,e=0,$(d,this.form).each(function(a,d){var e;a=$(a);if(a.fwData("forceSubmission")||a.attr("type")==="checkbox"||a.fwData("changed")||self.options.submitUnchanged)if(a.attr("type")!=="checkbox"||
a.is(":checked"))return b++,e=a.attr("name")?a.attr("name"):"unnamedInput_"+d,c[e]=a.val()}),b===0&&!this.options.submitFormIfAllUnchanged?setTimeout(function(){return f.enableForm(),f.ajaxSuccess()},1
):$.ajax({url:this.form.fwData("originalAction"),type:"POST",data:c,context:this,error:function(a){return f.callObservers("error",a.response)},success:function(a){return f.enableForm(),f.options.responseCheck
(a)?(f.callObservers("success",a),f.ajaxSuccess()):f.callObservers("error",a)}})},b.prototype.ajaxSuccess=function(){var b,c,d,e,f,g,h,i;h=this.allElements,i=[];for(f=0,g=h.length;f<g;f++)c=h[f],a.unsetChanged
(c,this),this.options.resetFormAfterSubmit?a.restoreInitialValue(c):a.storeInitialValue(c),e=c.input.val()===null||!c.input.val(),i.push(function(){var a;a=[];for(d in c)b=c[d],e?a.push(b.addClass("empty"
)):a.push(b.removeClass("empty"));return a}());return i},b}(),typeof window!="undefined"&&window!==null&&(window.Formwatcher=a,window.Watcher=b),$.domReady(function(){return a.scanDocument()})})).call(
this);