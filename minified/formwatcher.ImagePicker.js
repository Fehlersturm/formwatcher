/*  © Matias Meno // Graphics © by Tjandra Mayerhold  */var ImagePicker=Class.create({thumbnailSize:100,images:[],noImageURL:"http://www.zella-loshausen.de/zsl/DesktopModules/ColderSoftNews/Media/noimage_36x36.gif",imagesPath:"./",initialize:function(a,b,c){this.watcher=a,this.showListener=this.show.
bindAsEventListener(this),this.hideListener=this.hide.bindAsEventListener(this),b.get("button").observe("click",this.showListener),this.elements=b,this.allowEmpty=c?!0:!1},setImages:function(a){this.images=a},getNoImage:function(){return{src:this.noImageURL,name:"NO IMAGE",type:"remove"}},show:function(
a){$$("select","object","embed").invoke("setStyle",{visibility:"hidden"}),a&&a.stop(),this.containerElement||this.createElements(),this.containerElement.center(),this.containerElement.show()},hide:function(){$$("select","object","embed").invoke("setStyle",{visibility:"visible"}),this.containerElement&&
this.containerElement.hide()},selectImage:function(a,b){if(!b||b.type=="remove")b={src:"",name:""};this.elements.get("input").value=b.src,this.elements.get("display").value=b.name,Formwatcher.changed(this.elements,this.watcher),this.hide()},createElements:function(){this.containerElement=$(document.body
.appendChild(Builder.node("div",{className:"imagePicker"},[Builder.node("div",{className:"titleBar"},[Builder.node("div",{className:"wrapper"},[Builder.node("h1",Builder.node("span","Image Picker")),Builder.node("div",{className:"buttons"},[Builder.node("div",{className:"button close"},[$(Builder.node
("a",{href:"javascript:undefined"},Builder.node("span","Close X"))).observe("click",this.hideListener)])])])]),Builder.node("div",{className:"content"},[Builder.node("div",{className:"wrapper"},[Builder.node("div",{className:"thumbnails"})])]),Builder.node("div",{className:"footer"},[Builder.node("div"
,{className:"wrapper"},[Builder.node("div",{className:"functions"},[Builder.node("div",{className:"size"},["Size: ",Builder.node("div",{className:"slider"},[Builder.node("div",{className:"handle"})])])])])])]))),new Draggable(this.containerElement,{handle:this.containerElement.down(".titleBar")});var a=
function(a){this.thumbnailSize=a,this.containerElement.select(".thumbnail").invoke("setStyle",{width:a+"px"}),this.containerElement.select(".image").invoke("setStyle",{width:a+"px",height:a+"px"})};a=a.bind(this),new Control.Slider(this.containerElement.down(".slider .handle"),this.containerElement.down
(".slider"),{range:$R(40,150),values:$R(4,15).collect(function(a){return a*10}),sliderValue:this.thumbnailSize,onSlide:function(b){a(b)},onChange:function(b){a(b)}}),this.containerElement.down(".content").makeClipping(),setTimeout(this.createThumbnails.bind(this),1)},createThumbnails:function(){var a=
this.containerElement.down(".thumbnails");this.allowEmpty&&a.appendChild(this.getThumbnailElement(this.getNoImage())),this.images.each(function(b){a.appendChild(this.getThumbnailElement(b))},this),a.appendChild(Builder.node("div",{className:"wrap"}))},getThumbnailElement:function(a){var b=a.src.startsWith
("http://")?a.src:this.imagesPath+a.src,c=$(Builder.node("div",{className:"image "+a.type})).setStyle({width:this.thumbnailSize+"px",height:this.thumbnailSize+"px"});switch(a.type){case"remove":case"pattern":c.setStyle({backgroundImage:'url("'+b+'")'});break;case"gradient":case"picture":default:c.appendChild
(Builder.node("img",{src:b}))}return $(Builder.node("div",{className:"thumbnail",style:"width: "+this.thumbnailSize+"px"},[c,Builder.node("div",{className:"description"},a.name)])).observe("click",this.selectImage.bindAsEventListener(this,a))}});ImagePicker.supportedTypes=["picture","pattern","gradient"
];var decorator=Class.create(Formwatcher.Decorator,{name:"ImagePicker",description:"Converts a select of images into a nice image picker.",nodeNames:["SELECT"],classNames:["image"],decorate:function(a,b){var c=[],d=!1;$A(b.options).each(function(a){if(a.value.empty())d=!0;else{a=$(a);var b=ImagePicker
.supportedTypes.find(function(b){return a.hasClassName(b)})||ImagePicker.supportedTypes.first();c.push({src:a.value,name:a.text,type:b})}});var e=$A(b.options).find(function(a){return a.selected}),f=$(Builder.node("input",{name:b.name,value:b.getValue(),type:"text",style:"display:none"})),g=$(Builder
.node("input",{value:e.text,type:"text",readonly:"readonly",className:"imagePath"})),h=$(Builder.node("button",{type:"button"},"Change")),i=$(Builder.node("div",{className:"imagePickerElements"},[f,g,h]));b.insert({after:i}),Element.remove(b);var j=$H({input:f,display:g,button:h}),k=new this.Class(a,
j,d);return k.setImages(c),j},Class:ImagePicker});Formwatcher.decorators.push(new decorator);