<!DOCTYPE html>  <html> <head>   <title>formwatcher.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="formwatcher.Hint.html">                 formwatcher.Hint.coffee               </a>                                           <a class="source" href="formwatcher.html">                 formwatcher.coffee               </a>                                           <a class="source" href="formwatcher.validators.html">                 formwatcher.validators.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               formwatcher.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Formwatcher Version 2.0.0-dev
More infos at http://www.formwatcher.org</p>

<p>Copyright (c) 2012, Matias Meno
Graphics by Tjandra Mayerhold</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Returns or generates a UID for any html element</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$.fn.uid = </span><span class="o">-&gt;</span>
  <span class="nv">id = </span><span class="nx">@attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
  <span class="nx">unless</span> <span class="nx">id</span>
    <span class="nv">id = </span><span class="s">&quot;generatedUID&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">uidCounter</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">@attr</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="nx">id</span>
  <span class="nx">id</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Returns and stores attributes only for formwatcher.
Be careful when you get data because it does return the actual object, not
a copy of it. So if you manipulate an array, you don't have to store it again.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$.fn.fwData = </span><span class="nf">(name, value) -&gt;</span>
  <span class="nx">@data</span> <span class="s">&quot;_formwatcher&quot;</span><span class="p">,</span> <span class="p">{}</span>  <span class="nx">unless</span> <span class="nx">@data</span><span class="p">(</span><span class="s">&quot;_formwatcher&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">this</span>  <span class="k">if</span> <span class="nx">name</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
  <span class="nv">formwatcherAttributes = </span><span class="nx">@data</span><span class="p">(</span><span class="s">&quot;_formwatcher&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    <span class="nx">formwatcherAttributes</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="nx">formwatcherAttributes</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nx">@data</span> <span class="s">&quot;_formwatcher&quot;</span><span class="p">,</span> <span class="nx">formwatcherAttributes</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Formwatcher, the global namespace</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Formwatcher =</span>
  <span class="nv">version: </span><span class="s">&quot;2.0.0-dev&quot;</span>
  <span class="nv">debugging: </span><span class="kc">false</span>
  <span class="nv">uidCounter: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>A wrapper for console.debug that only forwards if <code>Formwatcher.debugging == true</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">debug: </span><span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">console</span><span class="p">,</span> <span class="nx">arguments</span> <span class="k">if</span> <span class="nx">@debugging</span> <span class="o">and</span> <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">debug</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Tries to find an existing errors element, and creates one if there isn't.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getErrorsElement: </span><span class="nf">(elements, createIfNotFound) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>

    <span class="nv">errors = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-errors&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
    <span class="nv">errors = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-errors&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">errors</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span> <span class="o">or</span> <span class="o">!</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="o">not</span> <span class="nx">errors</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">errors = </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;span&quot;</span><span class="p">))</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-errors&quot;</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">after</span> <span class="nx">errors</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">hide</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;errors&quot;</span><span class="p">).</span><span class="nx">addClass</span> <span class="s">&quot;fw-errors&quot;</span>
    <span class="nx">errors</span>

  <span class="nv">getLabel: </span><span class="nf">(elements, automatchLabel) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="nv">label = </span><span class="kc">undefined</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
      <span class="nv">label = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;label[for=&quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">)</span>
      <span class="nv">label = </span><span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>  <span class="nx">unless</span> <span class="nx">label</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">label</span> <span class="o">and</span> <span class="nx">automatchLabel</span>
      <span class="nv">label = </span><span class="nx">input</span><span class="p">.</span><span class="nx">prev</span><span class="p">()</span>
      <span class="nv">label = </span><span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>  <span class="k">if</span> <span class="o">not</span> <span class="nx">label</span><span class="p">.</span><span class="nx">length</span> <span class="o">or</span> <span class="nx">label</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span> <span class="o">isnt</span> <span class="s">&quot;LABEL&quot;</span> <span class="o">or</span> <span class="nx">label</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;for&quot;</span><span class="p">)</span>
    <span class="nx">label</span>

  <span class="nv">changed: </span><span class="nf">(elements, watcher) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="o">not</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;forceValidationOnChange&quot;</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span> <span class="o">and</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;previouslyChecked&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="nx">input</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:checked&quot;</span><span class="p">))</span> <span class="o">or</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;previousValue&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;forceValidationOnChange&quot;</span><span class="p">,</span> <span class="kc">false</span>
    <span class="nx">@setPreviousValueToCurrentValue</span> <span class="nx">elements</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialyChecked&quot;</span><span class="p">)</span> <span class="o">isnt</span> <span class="nx">input</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:checked&quot;</span><span class="p">))</span> <span class="o">or</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">isnt</span> <span class="s">&quot;checkbox&quot;</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialValue&quot;</span><span class="p">)</span> <span class="o">isnt</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span>
      <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">setChanged</span> <span class="nx">elements</span><span class="p">,</span> <span class="nx">watcher</span>
    <span class="k">else</span>
      <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">unsetChanged</span> <span class="nx">elements</span><span class="p">,</span> <span class="nx">watcher</span>
    <span class="nx">watcher</span><span class="p">.</span><span class="nx">validateElements</span> <span class="nx">elements</span>  <span class="k">if</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">validate</span>

  <span class="nv">setChanged: </span><span class="nf">(elements, watcher) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;changed&quot;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(index, element) -&gt;</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&quot;changed&quot;</span>

    <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span> <span class="kc">true</span>
    <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">restoreName</span> <span class="nx">elements</span>  <span class="nx">unless</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">submitUnchanged</span>
    <span class="nx">watcher</span><span class="p">.</span><span class="nx">submitForm</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">submitOnChange</span> <span class="o">and</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">ajax</span>

  <span class="nv">unsetChanged: </span><span class="nf">(elements, watcher) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">return</span>  <span class="nx">unless</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;changed&quot;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(index, element) -&gt;</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span> <span class="s">&quot;changed&quot;</span>

    <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span> <span class="kc">false</span>
    <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">removeName</span> <span class="nx">elements</span> <span class="nx">unless</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">submitUnchanged</span>

  <span class="nv">storeInitialValue: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;initialyChecked&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:checked&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;initialValue&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>

    <span class="nx">@setPreviousValueToInitialValue</span> <span class="nx">elements</span>

  <span class="nv">restoreInitialValue: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialyChecked&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">val</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialValue&quot;</span><span class="p">)</span>
    <span class="nx">@setPreviousValueToInitialValue</span> <span class="nx">elements</span>

  <span class="nv">setPreviousValueToInitialValue: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;previouslyChecked&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialyChecked&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;previousValue&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialValue&quot;</span><span class="p">)</span>

  <span class="nv">setPreviousValueToCurrentValue: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;previouslyChecked&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:checked&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;previousValue&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>

  <span class="nv">removeName: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&quot;&quot;</span>  <span class="nx">unless</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

  <span class="nv">restoreName: </span><span class="nf">(elements) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>

  <span class="nv">Decorators: </span><span class="p">[]</span>
  <span class="nv">decorate: </span><span class="nf">(watcher, input) -&gt;</span>
    <span class="nv">decorator = </span><span class="nx">_</span><span class="p">.</span><span class="nx">detect</span><span class="p">(</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">decorators</span><span class="p">,</span> <span class="nf">(decorator) -&gt;</span>
      <span class="kc">true</span>  <span class="k">if</span> <span class="nx">decorator</span><span class="p">.</span><span class="nx">accepts</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">decorator</span>
      <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Decorator \&quot;&quot;</span> <span class="o">+</span> <span class="nx">decorator</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s">&quot;\&quot; found for input field \&quot;&quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\&quot;.&quot;</span>
      <span class="nx">decorator</span><span class="p">.</span><span class="nx">decorate</span> <span class="nx">input</span>
    <span class="k">else</span>
      <span class="nv">input: </span><span class="nx">input</span>

  <span class="nv">Validators: </span><span class="p">[]</span>
  <span class="nv">currentWatcherId: </span><span class="mi">0</span>
  <span class="nv">watchers: </span><span class="p">[]</span>
  <span class="nv">add: </span><span class="nf">(watcher) -&gt;</span>
    <span class="nx">@watchers</span><span class="p">[</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">watcher</span>

  <span class="nv">get: </span><span class="nf">(id) -&gt;</span>
    <span class="nx">@watchers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>

  <span class="nv">getAll: </span><span class="o">-&gt;</span>
    <span class="nx">@watchers</span>

  <span class="nv">scanDocument: </span><span class="o">-&gt;</span>
    <span class="nv">handleForm = </span><span class="nf">(form) -&gt;</span>
      <span class="nv">form = </span><span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span>
      <span class="k">return</span>  <span class="k">if</span> <span class="nx">form</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;watcher&quot;</span><span class="p">)</span>
      <span class="nv">formId = </span><span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
      <span class="nv">options = </span><span class="p">{}</span>
      <span class="nv">options = </span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">formId</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">formId</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">formId</span>
      <span class="nv">domOptions = </span><span class="nx">form</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&quot;fw&quot;</span><span class="p">)</span>
      <span class="nv">options = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">domOptions</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">domOptions</span>
      <span class="k">new</span> <span class="nx">Watcher</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;form[data-fw], form[data-fw=\&quot;\&quot;]&quot;</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
      <span class="nx">handleForm</span> <span class="k">this</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nf">(options, formId) -&gt;</span>
      <span class="nx">handleForm</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nx">formId</span><span class="p">)</span>

  <span class="nv">watch: </span><span class="nf">(form, options) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;document&quot;</span><span class="p">).</span><span class="nx">ready</span> <span class="o">-&gt;</span>
      <span class="k">new</span> <span class="nx">Watcher</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>The ElementWatcher root class</h2>

<p>This is the base class for decorators and validators.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">_ElementWatcher</span>
  <span class="nv">name: </span><span class="s">&quot;No name&quot;</span>
  <span class="nv">description: </span><span class="s">&quot;No description&quot;</span>
  <span class="nv">nodeNames: </span><span class="kc">null</span> <span class="c1"># eg: `[ &quot;SELECT&quot; ]`</span>
  <span class="nv">classNames: </span><span class="p">[]</span> <span class="c1"># eg: `[ &quot;font&quot; ]`</span>
  <span class="nv">defaultOptions: </span><span class="p">{</span> <span class="p">}</span> <span class="c1">#  Overwrite this with your default options. Those options can be overridden in the watcher config.</span>
  <span class="nv">options: </span><span class="kc">null</span> <span class="c1"># On initialization this gets filled with the actual options so they don&#39;t have to be calculated every time.</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Stores the watcher, and creates a valid options object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@watcher) -&gt;</span>
    <span class="vi">@options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">@defaultOptions</span><span class="p">,</span> <span class="nx">watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">@name</span><span class="p">]</span> <span class="o">?</span> <span class="p">{</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Overwrite this function if your logic to which elements your decorator applies
is more complicated than a simple nodeName/className comparison.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">accepts: </span><span class="nf">(input) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If the config for a ElementWatcher is just false, it's disabled for the watcher.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">@watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">@name</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@watcher</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">@name</span><span class="p">]</span> <span class="o">==</span> <span class="kc">false</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">any</span><span class="p">(</span><span class="nx">@nodeNames</span><span class="p">,</span> <span class="nf">(nodeName) -&gt;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span> <span class="o">is</span> <span class="nx">nodeName</span>
    <span class="p">)</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">@classNames</span><span class="p">,</span> <span class="nf">(className) -&gt;</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">hasClass</span> <span class="nx">className</span>
    <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>Decorator class</h2>

<p>Decorators are used to improve the visuals and user interaction of form elements.</p>

<p>Implement it to create a new decorator.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">Decorator</span> <span class="k">extends</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">_ElementWatcher</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This function does all the magic.
It creates additional elements if necessary, and could instantiate an object
that will be in charge of handling this input.</p>

<p>This function has to return a hash of all fields that you want to get updated
with .focus and .changed classes. Typically this is just { input: THE_INPUT }</p>

<p><code>input</code> has to be the actual form element to transmit the data.
<code>label</code> is reserved for the actual label.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">decorate: </span><span class="nf">(watcher, input) -&gt;</span>
    <span class="nv">input: </span><span class="nx">input</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Validator class</h2>

<p>Instances of this class are meant to validate input fields</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">Validator</span> <span class="k">extends</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">_ElementWatcher</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Typically most validators work on every input field</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">nodeNames: </span><span class="p">[</span> <span class="s">&quot;INPUT&quot;</span><span class="p">,</span> <span class="s">&quot;TEXTAREA&quot;</span><span class="p">,</span> <span class="s">&quot;SELECT&quot;</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Return true if the validation passed, or an error message if not.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">validate: </span><span class="nf">(sanitizedValue, input) -&gt;</span>
    <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If your value can be sanitized (eg: integers should not have leading or trailing spaces)
this function should return the sanitized value.</p>

<p>When the user leaves the input field, the value will be updated with this value in the field.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sanitize: </span><span class="nf">(value) -&gt;</span>
    <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Default options</h2>

<p>Those are the default options a new watcher uses if nothing is provided.
Overwrite any of these when instantiating a watcher (or put it in <code>data-fw=''</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Formwatcher.defaultOptions =</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Whether to convert the form to an AJAX form.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ajax: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Whether or not the form should validate on submission. This will invoke
every validator attached to your input fields.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">validate: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>If ajax and submitOnChange are true, then the form will be submitted every
time an input field is changed. This removes the need of a submit button.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submitOnChange: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>If the form is submitted via AJAX, the formwatcher uses changed values.
Otherwise formwatcher removes the name parameter of the input fields so they
are not submitted.
Remember: checkboxes are ALWAYS submitted if checked, and never if unchecked.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submitUnchanged: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If you have <code>submitUnchanged = false</code> and the user did not change anything and
hit submit, there would not actually be anything submitted to the server.
To avoid that, formwatcher does not actually send the request. But if you want
that behaviour you can set this to true.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submitFormIfAllUnchanged: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>When the form is submitted with AJAX, this tells the formwatcher how to
leave the form afterwards. Eg: For guestbook posts this should probably be yes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resetFormAfterSubmit: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Creating ids for input fields, and setting the <code>for</code> attribute on the labels
is the right way to go, but can be a tedious task. If automatchLabel is true,
Formwatcher will automatically match the closest previous label without a <code>for</code>
attribute as the correct label.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">automatchLabel: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Checks the ajax transport if everything was ok. If this function returns
false formwatcher assumes that the form submission resulted in an error.
So, if this function returns true <code>onSuccess</code> will be called. If false,
<code>onError</code> is called.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">responseCheck: </span><span class="nf">(data) -&gt;</span> <span class="o">not</span> <span class="nx">data</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>This function gets called before submitting the form. You could hide the form
or show a spinner here.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onSubmit: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>If the responseCheck function returns true, this function gets called.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onSuccess: </span><span class="nf">(data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>If the responseCheck function returns false, this function gets called.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onError: </span><span class="nf">(data) -&gt;</span> <span class="nx">alert</span> <span class="nx">data</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>This is a map of options for your different forms. You can simply overwrite it
to specify your form configurations, if it is too complex to be put in the
form data-fw='' field.</p>

<p><strong>CAREFUL</strong>: When you set options here, they will be overwritten by the DOM options.</p>

<p>Example:</p>

<pre><code>Formwatcher.options.myFormId = { ajax: true };
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Formwatcher.options = </span><span class="p">{</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>The Watcher class</h2>

<p>This is the class that gets instantiated for each form.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Watcher</span>
  <span class="nv">constructor: </span><span class="nf">(form, options) -&gt;</span>
    <span class="vi">@form = </span><span class="p">(</span><span class="k">if</span> <span class="k">typeof</span> <span class="nx">form</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="k">then</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nx">form</span><span class="p">)</span> <span class="k">else</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span>
      <span class="k">throw</span> <span class="p">(</span><span class="s">&quot;Form element not found.&quot;</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="k">throw</span> <span class="p">(</span><span class="s">&quot;The jQuery contained more than 1 element.&quot;</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">throw</span> <span class="p">(</span><span class="s">&quot;The element was not a form.&quot;</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span> <span class="o">isnt</span> <span class="s">&quot;FORM&quot;</span>
    <span class="vi">@allElements = </span><span class="p">[]</span>
    <span class="vi">@id = </span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">currentWatcherId</span><span class="o">++</span>
    <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">add</span> <span class="k">this</span>
    <span class="vi">@observers = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Putting the watcher object in the form element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@form</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;watcher&quot;</span><span class="p">,</span> <span class="k">this</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;originalAction&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;action&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">attr</span> <span class="s">&quot;action&quot;</span><span class="p">,</span> <span class="s">&quot;javascript:undefined;&quot;</span>
    <span class="vi">@options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="nx">options</span> <span class="o">or</span> <span class="p">{})</span>
    <span class="vi">@decorators = </span><span class="p">[]</span>
    <span class="vi">@validators = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">Decorators</span><span class="p">,</span> <span class="p">(</span><span class="nx">Decorator</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@decorators</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Decorator</span> <span class="nx">@</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">Validators</span><span class="p">,</span> <span class="p">(</span><span class="nx">Validator</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@validators</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Validator</span> <span class="nx">@</span>

    <span class="nx">@observe</span> <span class="s">&quot;submit&quot;</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">onSubmit</span>
    <span class="nx">@observe</span> <span class="s">&quot;success&quot;</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">onSuccess</span>
    <span class="nx">@observe</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">onError</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;:input&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">),</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">input = </span><span class="nx">$</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
      <span class="nx">unless</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;initialized&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;hidden&quot;</span>
          <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;forceSubmission&quot;</span><span class="p">,</span> <span class="kc">true</span>
        <span class="k">else</span>
          <span class="nv">elements = </span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">decorate</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">input</span>
          <span class="k">if</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">get</span><span class="p">()</span> <span class="o">isnt</span> <span class="nx">input</span><span class="p">.</span><span class="nx">get</span><span class="p">()</span>
            <span class="nx">elements</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;class&quot;</span><span class="p">)</span>
            <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
          <span class="nx">unless</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">label</span>
            <span class="nv">label = </span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">(</span><span class="nx">elements</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">automatchLabel</span><span class="p">)</span>
            <span class="nv">elements.label = </span><span class="nx">label</span>  <span class="k">if</span> <span class="nx">label</span>
          <span class="nx">unless</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">errors</span>
            <span class="nv">errorsElement = </span><span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">getErrorsElement</span><span class="p">(</span><span class="nx">elements</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
            <span class="nv">elements.errors = </span><span class="nx">errorsElement</span>
          <span class="nx">@allElements</span><span class="p">.</span><span class="nx">push</span> <span class="nx">elements</span>
          <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;validators&quot;</span><span class="p">,</span> <span class="p">[]</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@validators</span><span class="p">,</span> <span class="p">(</span><span class="nx">validator</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">accepts</span> <span class="nx">input</span><span class="p">,</span> <span class="nx">@</span>
              <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Validator \&quot;&quot;</span> <span class="o">+</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s">&quot;\&quot; found for input field \&quot;&quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\&quot;.&quot;</span>
              <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validators&quot;</span><span class="p">).</span><span class="nx">push</span> <span class="nx">validator</span>

          <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">storeInitialValue</span> <span class="nx">elements</span>
          <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="o">-&gt;</span>
              <span class="nx">@addClass</span> <span class="s">&quot;empty&quot;</span>
          <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">removeName</span> <span class="nx">elements</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">submitUnchanged</span>
          <span class="nv">onchangeFunction = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">changed</span><span class="p">,</span> <span class="nx">Formwatcher</span><span class="p">,</span> <span class="nx">elements</span><span class="p">,</span> <span class="nx">@</span>
          <span class="nv">validateElementsFunction = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">@validateElements</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">elements</span><span class="p">,</span> <span class="kc">true</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="o">-&gt;</span>
            <span class="nx">@focus</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="o">-&gt;</span>
              <span class="nx">@addClass</span> <span class="s">&quot;focus&quot;</span>
            <span class="p">,</span> <span class="k">this</span><span class="p">)</span>
            <span class="nx">@blur</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="o">-&gt;</span>
              <span class="nx">@removeClass</span> <span class="s">&quot;focus&quot;</span>
            <span class="p">,</span> <span class="k">this</span><span class="p">)</span>
            <span class="nx">@change</span> <span class="nx">onchangeFunction</span>
            <span class="nx">@blur</span> <span class="nx">onchangeFunction</span>
            <span class="nx">@keyup</span> <span class="nx">validateElementsFunction</span>

    <span class="nv">submitButtons = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;:submit&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">)</span>
    <span class="nv">hiddenSubmitButtonElement = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;\&quot; value=\&quot;\&quot; /&gt;&quot;</span><span class="p">)</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">append</span> <span class="nx">hiddenSubmitButtonElement</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">submitButtons</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">element = </span><span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">click</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">hiddenSubmitButtonElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">attr</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&quot;&quot;</span>
        <span class="nx">@submitForm</span><span class="p">()</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>

  <span class="nv">callObservers: </span><span class="nf">(eventName) -&gt;</span>
    <span class="nv">args = </span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">],</span> <span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">args</span>

  <span class="nv">observe: </span><span class="nf">(eventName, func) -&gt;</span>
    <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="k">if</span> <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">].</span><span class="nx">push</span> <span class="nx">func</span>
    <span class="nx">@</span>

  <span class="nv">stopObserving: </span><span class="nf">(eventName, func) -&gt;</span>
    <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">select</span> <span class="nx">@observers</span><span class="p">[</span><span class="nx">eventName</span><span class="p">],</span> <span class="o">-&gt;</span>
      <span class="k">this</span> <span class="o">isnt</span> <span class="nx">func</span>
    <span class="nx">@</span>

  <span class="nv">enableForm: </span><span class="o">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;:input&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">).</span><span class="nx">prop</span> <span class="s">&quot;disabled&quot;</span><span class="p">,</span> <span class="kc">false</span>

  <span class="nv">disableForm: </span><span class="o">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;:input&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">).</span><span class="nx">prop</span> <span class="s">&quot;disabled&quot;</span><span class="p">,</span> <span class="kc">true</span>

  <span class="nv">submitForm: </span><span class="nf">(e) -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">validate</span> <span class="o">or</span> <span class="nx">@validateForm</span><span class="p">()</span>
      <span class="nx">@callObservers</span> <span class="s">&quot;submit&quot;</span>
      <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span>
        <span class="nx">@disableForm</span><span class="p">()</span>
        <span class="nx">@submitAjax</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@form</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;action&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;originalAction&quot;</span><span class="p">)</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="o">-&gt;</span>
          <span class="nx">@form</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span>
          <span class="nx">@disableForm</span><span class="p">()</span>
        <span class="p">,</span> <span class="k">this</span><span class="p">)</span>
        <span class="kc">false</span>
    <span class="k">else</span>

  <span class="nv">validateForm: </span><span class="o">-&gt;</span>
    <span class="nv">validated = </span><span class="kc">true</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@allElements</span><span class="p">,</span> <span class="nf">(elements) -&gt;</span>
      <span class="nv">validated = </span><span class="kc">false</span> <span class="nx">unless</span> <span class="nx">@validateElements</span><span class="p">(</span><span class="nx">elements</span><span class="p">)</span>
    <span class="p">,</span> <span class="k">this</span>
    <span class="nx">validated</span>

  <span class="nv">validateElements: </span><span class="nf">(elements, inlineValidating) -&gt;</span>
    <span class="nv">input = </span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span>
    <span class="nv">validated = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validators&quot;</span><span class="p">).</span><span class="nx">length</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">inlineValidating</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;lastValidatedValue&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;lastValidatedValue&quot;</span><span class="p">)</span> <span class="o">isnt</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;lastValidatedValue&quot;</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
        <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Validating input &quot;</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;validationErrors&quot;</span><span class="p">,</span> <span class="p">[]</span>
        <span class="nv">validated = </span><span class="nx">_</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validators&quot;</span><span class="p">),</span> <span class="nf">(validator) -&gt;</span>
          <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">is</span> <span class="s">&quot;&quot;</span> <span class="o">and</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">name</span> <span class="o">isnt</span> <span class="s">&quot;Required&quot;</span>
            <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Validating &quot;</span> <span class="o">+</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s">&quot;. Field was empty so continuing.&quot;</span>
            <span class="k">return</span> <span class="kc">true</span>
          <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Validating &quot;</span> <span class="o">+</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">name</span>
          <span class="nv">validationOutput = </span><span class="nx">validator</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">validator</span><span class="p">.</span><span class="nx">sanitize</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()),</span> <span class="nx">input</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">validationOutput</span> <span class="o">isnt</span> <span class="kc">true</span>
            <span class="nv">validated = </span><span class="kc">false</span>
            <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validationErrors&quot;</span><span class="p">).</span><span class="nx">push</span> <span class="nx">validationOutput</span>
            <span class="k">return</span> <span class="kc">false</span>
          <span class="kc">true</span>
        <span class="p">)</span>
        <span class="nx">unless</span> <span class="nx">validated</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(element) -&gt;</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span> <span class="s">&quot;validated&quot;</span>

          <span class="nx">unless</span> <span class="nx">inlineValidating</span>
            <span class="nx">elements</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validationErrors&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;&lt;br /&gt;&quot;</span><span class="p">)).</span><span class="nx">show</span><span class="p">()</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(element) -&gt;</span>
              <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&quot;error&quot;</span>
        <span class="k">else</span>
          <span class="nx">elements</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(element) -&gt;</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&quot;validated&quot;</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span> <span class="s">&quot;error&quot;</span>

          <span class="nx">elements</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span> <span class="s">&quot;forceValidationOnChange&quot;</span><span class="p">,</span> <span class="kc">true</span>  <span class="k">if</span> <span class="nx">inlineValidating</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">inlineValidating</span> <span class="o">and</span> <span class="nx">validated</span>
        <span class="nv">sanitizedValue = </span><span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;lastValidatedValue&quot;</span><span class="p">)</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;validators&quot;</span><span class="p">),</span> <span class="nf">(validator) -&gt;</span>
          <span class="nv">sanitizedValue = </span><span class="nx">validator</span><span class="p">.</span><span class="nx">sanitize</span><span class="p">(</span><span class="nx">sanitizedValue</span><span class="p">)</span>

        <span class="nx">input</span><span class="p">.</span><span class="nx">val</span> <span class="nx">sanitizedValue</span>
    <span class="k">else</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="nf">(element) -&gt;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&quot;validated&quot;</span>
    <span class="nx">validated</span>

  <span class="nv">submitAjax: </span><span class="o">-&gt;</span>
    <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">debug</span> <span class="s">&quot;Submitting form via AJAX.&quot;</span>
    <span class="nv">fields = </span><span class="p">{}</span>
    <span class="nv">i = </span><span class="mi">0</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;:input&quot;</span><span class="p">,</span> <span class="nx">@form</span><span class="p">),</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">input = </span><span class="nx">$</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
      <span class="nx">fields</span><span class="p">[(</span><span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&quot;unnamedInput_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">))]</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">isnt</span> <span class="s">&quot;checkbox&quot;</span> <span class="o">or</span> <span class="nx">input</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:checked&quot;</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;forceSubmission&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;checkbox&quot;</span> <span class="o">or</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;changed&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">submitUnchanged</span>

    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">submitFormIfAllUnchanged</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="o">-&gt;</span>
        <span class="nx">@enableForm</span><span class="p">()</span>
        <span class="nx">@ajaxSuccess</span><span class="p">()</span>
      <span class="p">,</span> <span class="k">this</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span>
        <span class="nv">url: </span><span class="nx">@form</span><span class="p">.</span><span class="nx">fwData</span><span class="p">(</span><span class="s">&quot;originalAction&quot;</span><span class="p">)</span>
        <span class="nv">type: </span><span class="s">&quot;POST&quot;</span>
        <span class="nv">data: </span><span class="nx">fields</span>
        <span class="nv">context: </span><span class="k">this</span>
        <span class="nv">success: </span><span class="nf">(data) -&gt;</span>
          <span class="nx">@enableForm</span><span class="p">()</span>
          <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">responseCheck</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
            <span class="nx">@callObservers</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="nx">data</span>
          <span class="k">else</span>
            <span class="nx">@callObservers</span> <span class="s">&quot;success&quot;</span><span class="p">,</span> <span class="nx">data</span>
            <span class="nx">@ajaxSuccess</span><span class="p">()</span>
    <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>

  <span class="nv">ajaxSuccess: </span><span class="o">-&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@allElements</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nf">(elements) -&gt;</span>
      <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">unsetChanged</span> <span class="nx">elements</span><span class="p">,</span> <span class="k">this</span>
      <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">resetFormAfterSubmit</span>
        <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">restoreInitialValue</span> <span class="nx">elements</span>
      <span class="k">else</span>
        <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">storeInitialValue</span> <span class="nx">elements</span>
      <span class="nv">isEmpty = </span><span class="p">(</span><span class="nx">elements</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">elements</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="nx">isEmpty</span>
          <span class="nx">@addClass</span> <span class="s">&quot;empty&quot;</span>
        <span class="k">else</span>
          <span class="nx">@removeClass</span> <span class="s">&quot;empty&quot;</span>
    <span class="p">,</span> <span class="k">this</span><span class="p">)</span>



<span class="k">if</span> <span class="nb">window</span><span class="o">?</span>
  <span class="nb">window</span><span class="p">.</span><span class="nv">Formwatcher = </span><span class="nx">Formwatcher</span>
  <span class="nb">window</span><span class="p">.</span><span class="nv">Watcher = </span><span class="nx">Watcher</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span> <span class="nx">Formwatcher</span><span class="p">.</span><span class="nx">scanDocument</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 